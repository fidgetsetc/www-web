var SAUpsellTrigger;(function(n){function o(n){var t=new RegExp("^https://(www.|cn.)?(bing.com|staging-bing-int.com)");return!n||!t.test(n)?!1:!0}function w(n){var t=new RegExp("^sapphirebing://");return!n||!t.test(n)?!1:!0}function b(n){var t=new RegExp("^[a-zA-Z0-9]{7,8}_[a-zA-Z0-9]{7,8}$"),i=new RegExp("^[a-zA-Z0-9]{7,8}$");return!n||!(t.test(n)||i.test(n))?!1:!0}function s(n,t,i,r){r===void 0&&(r="default");o(n)||(Log.Log("OpalUpsell_SAUpsellTriggers","InvalidFallbackLink","".concat(r,", ").concat(n)),n=v);w(t)||(Log.Log("OpalUpsell_SAUpsellTriggers","InvalidDeeplink","".concat(r,", ").concat(t)),t=y);b(i)||(Log.Log("OpalUpsell_SAUpsellTriggers","InvalidTracker","".concat(r,", ").concat(i)),i=p);var u="https://k5nc.adj.st/".concat(t.substring(15),"&adj_t=").concat(i,"&adjust_deep_link=").concat(encodeURIComponent(t),"&adj_redirect_ios=").concat(encodeURIComponent(n),"&adj_redirect_android=").concat(encodeURIComponent(n)),f=navigator.userAgent&&navigator.userAgent.toLocaleLowerCase().indexOf("android")!==-1?"android":"ios",e=f==="android"?2e3:500;setTimeout(function(){Log.Log("OpalUpsell_SAUpsellTriggers","JumpAdjust","".concat(r,",").concat(i,",").concat(u));window.location.href=u},0);setTimeout(function(){Log.Log("OpalUpsell_SAUpsellTriggers","JumpFallback","".concat(r,",").concat(i,",").concat(n));window.location.href=n},e)}function h(n,i){var r;return i===void 0&&(i=""),i&&((r=t[n])===null||r===void 0?void 0:r.hasOwnProperty(i))||(i="default"),t[n][i]}function c(n,t,i,r){return"sapphirebing://browser?url=".concat(encodeURIComponent(n),"&network=").concat(encodeURIComponent(t),"&campaign=").concat(encodeURIComponent(i),"&adgroup=").concat(encodeURIComponent(r))}function k(n){return o(location===null||location===void 0?void 0:location.origin)?location.origin+"/search?q="+n:"https://www.bing.com/search?q="+n}function d(){var t=new RegExp(/(sapphire|edge|huawei|edg|outlook|skype)/i),n=sj_cook.get("SRCHCNT",""),i=t.test(navigator.userAgent)||n&&n.indexOf("Skype")!==-1;return i?(Log.Log("OpalUpsell_SAUpsellTriggers","checkUserAgent","UserAgent cannot be first party apps"),!1):!0}function g(){var n="numberOfTimesRedirectedToSapphire",i="lastTimeRedirectedToSapphire",r=new Date,f=localStorage.getItem(i),e,o,t;if(f)if(e=new Date(f),o=r.toDateString()===e.toDateString(),o){if(t=parseInt(localStorage.getItem(n)||"0",10),t>=u)return Log.Log("OpalUpsell_SAUpsellTriggers","checkVisitCountValidity","MaxVisitsReached"),!1;localStorage.setItem(n,(t+1).toString())}else localStorage.setItem(n,"1");else localStorage.setItem(n,"1");return localStorage.setItem(i,r.toISOString()),!0}function nt(){var n="sapphireRedirectionDisableOnce",i=localStorage.getItem(r),t;return!i||Date.now()-parseInt(i)>f*1e3?(localStorage.setItem(r,Date.now().toString()),!0):(t=localStorage.getItem(n),t&&t!=="false"?(localStorage.setItem(n,"false"),!0):(Log.Log("OpalUpsell_SAUpsellTriggers","canTriggerSearch","User redirection blocked, user tried to search within 30s cooldown"),localStorage.setItem(n,"true"),!1))}function tt(n,t){u=t!==null&&t!==void 0?t:3;f=n!==null&&n!==void 0?n:30}function it(){return g()&&d()&&nt()}function rt(n,t,i){n===void 0&&(n="");t===void 0&&(t="");var r=h("query",t),u=i!==null&&i!==void 0?i:k(n),f=c(u,r.networkId,r.campaignId,r.adgroupId);s(u,f,r.tracker,"query")}function ut(n,t){if(n===void 0&&(n=""),t===void 0&&(t=""),!n){Log.Log("OpalUpsell_SAUpsellTriggers","InvalidParameter_Link","search ".concat(n));return}var i=h("search",t),r=n,u=c(r,i.networkId,i.campaignId,i.adgroupId);s(r,u,i.tracker,"search")}function ft(n,t,r){var u,f,o,s;t===void 0&&(t="");u=new URL(i);f=new URLSearchParams(n.substring(n.indexOf("?")));f.forEach(function(n,t){u.searchParams.set(t,n)});u.searchParams.set("FORM",e(t));u.searchParams.set("sapattid",t);o=function(){Log.Log("OpalUpsell_SAUpsellTriggers","searchNativelyByApp","fallback callback triggered",!1,"PositionID",t);r?_w.open(n,r):_w.location.href=n};s=function(){return window.addEventListener("focus",o,{once:!0})};window.addEventListener("blur",s,{once:!0});Log.Log("OpalUpsell_SAUpsellTriggers","searchNativelyByApp","mobile native universal link triggered",!1,"PositionID",t);window.location.href=u.toString()}function et(n,t,r,u){var h,c,f,s,o,l,a;if(t===void 0&&(t=""),f=new URL(i),n&&n.length>0)for(s=0;s<n.length;s++)o=n[s],(((h=o.id)===null||h===void 0?void 0:h.includes("sa"))||((c=o.id)===null||c===void 0?void 0:c.includes("sb_form_q")))&&o.name&&o.value&&f.searchParams.set(o.name,o.value);!f.searchParams.has("q")&&u&&f.searchParams.set("q",u);f.searchParams.set("FORM",e(t));f.searchParams.set("sapattid",t);l=function(){Log.Log("OpalUpsell_SAUpsellTriggers","queryNativelyByApp","fallback callback triggered",!1,"PositionID",t);r()};a=function(){return window.addEventListener("focus",l,{once:!0})};window.addEventListener("blur",a,{once:!0});Log.Log("OpalUpsell_SAUpsellTriggers","queryNativelyByApp","mobile native universal link triggered",!1,"PositionID",t);window.location.href=f.toString()}var t={query:{"default":{networkId:"125czop8_12hga57x",campaignId:"13w3avcz_13ld58ji",adgroupId:"",tracker:"13w3avcz_13ld58ji"},Bing_DirectOpen_HP:{networkId:"125czop8_12hga57x",campaignId:"13g24d1z_13nu7vh1",adgroupId:"139c298d_135xw5ht",tracker:"139c298d_135xw5ht"},Bing_DirectOpen_SERP_T1:{networkId:"125czop8_12hga57x",campaignId:"13g24d1z_13nu7vh1",adgroupId:"13frk971_135dxmp6",tracker:"13frk971_135dxmp6"},Bing_DirectOpen_SERP_T2:{networkId:"125czop8_12hga57x",campaignId:"13g24d1z_13nu7vh1",adgroupId:"13pi2mfj_138mwjjk",tracker:"13pi2mfj_138mwjjk"},Bing_DirectOpen_SERP_T3:{networkId:"125czop8_12hga57x",campaignId:"13g24d1z_13nu7vh1",adgroupId:"138jmzvg_13ty271x",tracker:"138jmzvg_13ty271x"}},search:{"default":{networkId:"125czop8_12hga57x",campaignId:"13w3avcz_13ld58ji",adgroupId:"",tracker:"13w3avcz_13ld58ji"}}},l="MB0039",a="MB0040",v="https://www.bing.com",y="sapphirebing://home",p="13w3avcz_13ld58ji",i="https://m.bing.com/search",r="lastSapphireRedirectionTimestamp",u=3,f=30,e=function(n){return n.indexOf("HP")>0?l:a};n.setConfigs=tt;n.shouldRedirectToSapphire=it;n.queryByApp=rt;n.searchByApp=ut;n.searchNativelyByApp=ft;n.queryNativelyByApp=et})(SAUpsellTrigger||(SAUpsellTrigger={}))